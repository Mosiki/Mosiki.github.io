<!DOCTYPE html>
<html>
<head>
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?e57563c03439d3ad35210295cd32edcb"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    
    <title>实战基于Redis实现阻塞队列 | WeJan&#39;s Blog | 实战为王，记录在工作中技术使用的点点滴滴。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Redis阻塞队列实现,异步队列处理">
    <meta name="description" content="日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要进行异步处理，做法就是讲要处理的数据添加到队列当中，然后按照排队的先后顺序进行异步处理。   这个队列，可以是专业的消息队列，如 RocketMQ/RabbitMQ ">
<meta name="keywords" content="Redis阻塞队列实现,异步队列处理">
<meta property="og:type" content="article">
<meta property="og:title" content="实战基于Redis实现阻塞队列">
<meta property="og:url" content="http://nullpointer.pw/redis-block-queue.html">
<meta property="og:site_name" content="WeJan&#39;s Blog">
<meta property="og:description" content="日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要进行异步处理，做法就是讲要处理的数据添加到队列当中，然后按照排队的先后顺序进行异步处理。   这个队列，可以是专业的消息队列，如 RocketMQ/RabbitMQ 等，一般项目中，如果只是为了进行异步，未免有点杀鸡用牛刀的意味。也可以使用基于">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img12345.5-project.com/blog/20200614160321.png">
<meta property="og:image" content="http://img12345.5-project.com/blog/redis-queue.gif">
<meta property="og:updated_time" content="2020-06-14T09:00:19.640Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="实战基于Redis实现阻塞队列">
<meta name="twitter:description" content="日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要进行异步处理，做法就是讲要处理的数据添加到队列当中，然后按照排队的先后顺序进行异步处理。   这个队列，可以是专业的消息队列，如 RocketMQ/RabbitMQ 等，一般项目中，如果只是为了进行异步，未免有点杀鸡用牛刀的意味。也可以使用基于">
<meta name="twitter:image" content="http://img12345.5-project.com/blog/20200614160321.png">
    
        <link rel="alternate" type="application/atom+xml" title="WeJan&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.0">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeJan</h5>
          <a href="mailto:vcmq@foxmail.com" title="vcmq@foxmail.com" class="mail">vcmq@foxmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/catelog"  >
                <i class="icon icon-lg icon-archives"></i>
                文章分类目录
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-th-list"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/others/tts.html"  >
                <i class="icon icon-lg icon-arrows-h"></i>
                TTS
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/others/uml.html"  >
                <i class="icon icon-lg icon-code"></i>
                UML
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/others/play.html"  >
                <i class="icon icon-lg icon-play"></i>
                Video
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Mosiki" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">实战基于Redis实现阻塞队列</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">实战基于Redis实现阻塞队列</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-06-14T07:02:17.000Z" itemprop="datePublished" class="page-time">
  2020-06-14
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Redis/">Redis</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Redis-基础"><span class="post-toc-number">1.</span> <span class="post-toc-text">Redis 基础</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码实现队列消息生产者"><span class="post-toc-number">2.</span> <span class="post-toc-text">代码实现队列消息生产者</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#代码实现队列消息消费者"><span class="post-toc-number">3.</span> <span class="post-toc-text">代码实现队列消息消费者</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试代码"><span class="post-toc-number">4.</span> <span class="post-toc-text">测试代码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#项目使用方式"><span class="post-toc-number">5.</span> <span class="post-toc-text">项目使用方式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#本文完整代码下载"><span class="post-toc-number">6.</span> <span class="post-toc-text">本文完整代码下载</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-基于Redis实现阻塞队列实战"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">实战基于Redis实现阻塞队列</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-06-14 15:02:17" datetime="2020-06-14T07:02:17.000Z"  itemprop="datePublished">2020-06-14</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Redis/">Redis</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要进行异步处理，做法就是讲要处理的数据添加到队列当中，然后按照排队的先后顺序进行异步处理。  </p>
<p>这个队列，可以是专业的消息队列，如 RocketMQ/RabbitMQ 等，一般项目中，如果只是为了进行异步，未免有点杀鸡用牛刀的意味。<br>也可以使用基于 JVM 内存实现队列，但是如果项目进行了重启，就会造成队列数据丢失。<br>大部分的项目都会用到 Redis 中间件作为缓存使用，此时使用 Redis 的 list 结构来实现队列则是非常合适的选择。  </p>
<p>因此，本文主要讲解基于 Redis 的方式实现异步队列。</p>
<a id="more"></a>
<p>基于 Redis 的 list 实现队列的方式也有多种，先说第一种不推荐的方式，即使用<code>LPUSH</code>生产消息，然后 while(true) 中通过<code>RPOP</code>消费消息，这种方式的确可以实现，但是不断代码不断的轮询，势必会消耗一些系统的资源。</p>
<p>第二种方式也是不推荐的方式，也是通过 <code>LPUSH</code>生产消息，然后通过 <code>BRPOP</code> 进行<strong>阻塞地</strong>等待并消费消息，这种方式较第一种方式减少了无用的轮询，降低系统资源的消耗，但是可能会存在队列消息丢失的情况，如果取出了消息然后处理失败，这个被取出的消息就将丢失。</p>
<p>第二种方式就是下文要介绍的方式，首先也是通过 <code>LPUSH</code> 生产消息，然后通过 <code>BRPOPLPUSH</code><strong>阻塞</strong>地等待 list 新消息到来，有了新消息才开始消费，同时将消息备份到另外一个 list 当中，这种方式具备了第二种方式的优点，即减少了无用的轮询，同时也对消息进行了备份不会丢失数据，如果处理成功，可以通过 <code>LREM</code> 对备份的 list 中当前的这条消息进行删除处理。这种方式实现方式可以参考 <a href="http://redisdoc.com/list/rpoplpush.html#id3">模式： 安全的队列 </a>.<br><img src="http://img12345.5-project.com/blog/20200614160321.png" alt="">  </p>
<h2 id="Redis-基础"><a href="#Redis-基础" class="headerlink" title="Redis 基础"></a>Redis 基础</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 将一个或多个值 value 插入到列表 key 的表头</span><br><span class="line">LPUSH key value [value …]</span><br><span class="line"></span><br><span class="line"># 阻塞式等待，将列表 source 中的最后一个元素 (尾元素) 弹出，并返回给客户端。将 source 弹出的元素插入到列表 destination ，作为 destination 列表的的头元素。超时参数 timeout 接受一个以秒为单位的数字作为值。超时参数设为 0 表示阻塞时间可以无限期延长 (block indefinitely) 。</span><br><span class="line">BRPOPLPUSH source destination timeout</span><br><span class="line"></span><br><span class="line"># 根据参数 count 的值，移除列表中与参数 value 相等的元素。</span><br><span class="line">LREM key count value</span><br></pre></td></tr></table></figure>
<h2 id="代码实现队列消息生产者"><a href="#代码实现队列消息生产者" class="headerlink" title="代码实现队列消息生产者"></a>代码实现队列消息生产者</h2><p>笔者使用的是 Spring 相关 API 实现对 Redis 指令的调用。首先实现消息的生产代码，封装到一个工具类方法当中。这里很简单，就是调用了 lpush 方法，将序列化的 key 和 value 添加到列表当中去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lPush</span><span class="params">(@Nonnull String key, @Nonnull String value)</span> </span>&#123;</span><br><span class="line">  RedisConnection connection = RedisConnectionUtils.getConnection(connectionFactory);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] byteKey = RedisSerializer.string().serialize(getKey(key));</span><br><span class="line">    <span class="keyword">byte</span>[] byteValue = RedisSerializer.string().serialize(value);</span><br><span class="line">    <span class="keyword">assert</span> byteKey != <span class="keyword">null</span>;</span><br><span class="line">    connection.lPush(byteKey, byteValue);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    RedisConnectionUtils.releaseConnection(connection, connectionFactory);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="代码实现队列消息消费者"><a href="#代码实现队列消息消费者" class="headerlink" title="代码实现队列消息消费者"></a>代码实现队列消息消费者</h2><p> 因为实现队列消费消息的代码比较多，不可能每个需要阻塞消费的地方，对需要写这一坨代码，因此使用 Java8 的函数式接口实现方法的传递，同时阻塞式获取消息代码使用新线程去执行。</p>
<p>有人看到以下代码要吐槽了，不是说不用 while(true) 吗，怎么你这里面还是有，这里稍微解释一下，因为 SpringBoot 一般会指定 timeout 的全局超时时间，即使 <code>BRPOPLPUSH</code> 设置了 0，即无限期，当超出了 timeout 设置的值时，就会抛出 QueryTimeoutException 异常导致线程退出，因此添加了 try/catch 对异常进行捕获并忽略，同时使用 while(true) 保证线程可以继续执行。<br>代码中记录了当前消息处理结果，如果处理结果为成功，需要对备份队列的当前消息进行删除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bRPopLPush</span><span class="params">(@Nonnull String key, Consumer&lt;String&gt; consumer)</span> </span>&#123;</span><br><span class="line">  CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">    RedisConnection connection = RedisConnectionUtils.getConnection(connectionFactory);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">byte</span>[] srcKey = RedisSerializer.string().serialize(getKey(key));</span><br><span class="line">      <span class="keyword">byte</span>[] dstKey = RedisSerializer.string().serialize(getBackupKey(key));</span><br><span class="line">      <span class="keyword">assert</span> srcKey != <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">assert</span> dstKey != <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] byteValue = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          byteValue = connection.bRPopLPush(<span class="number">0</span>, srcKey, dstKey);</span><br><span class="line">          <span class="keyword">if</span> (byteValue != <span class="keyword">null</span> &amp;&amp; byteValue.length != <span class="number">0</span>) &#123;</span><br><span class="line">            consumer.accept(<span class="keyword">new</span> String(byteValue));</span><br><span class="line">            success = <span class="keyword">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">          <span class="comment">// 防止获取 key 达到超时时间抛出 QueryTimeoutException 异常退出</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (success) &#123;</span><br><span class="line">            <span class="comment">// 处理成功才删除备份队列的 key</span></span><br><span class="line">            connection.lRem(dstKey, <span class="number">1</span>, byteValue);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      RedisConnectionUtils.releaseConnection(connection, connectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLPush</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">  String queueA = <span class="string">"queueA"</span>;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    String msg = <span class="string">"Hello-"</span> + i++;</span><br><span class="line">    redisBlockQueue.lPush(queueA, msg);</span><br><span class="line">    System.out.println(<span class="string">"lPush: "</span> + msg);</span><br><span class="line">    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBRPopLPush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  String queueA = <span class="string">"queueA"</span>;</span><br><span class="line">  redisBlockQueue.bRPopLPush(queueA, (val) -&gt; &#123;</span><br><span class="line">    <span class="comment">// 在这里处理具体的业务逻辑</span></span><br><span class="line">    System.out.println(<span class="string">"val: "</span> + val);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 防止 Junit 进程退出</span></span><br><span class="line">  LockSupport.park();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：<br><img src="http://img12345.5-project.com/blog/redis-queue.gif" alt="">  </p>
<h2 id="项目使用方式"><a href="#项目使用方式" class="headerlink" title="项目使用方式"></a>项目使用方式</h2><p>为了方便使用，我将其抽取为了一个工具类，使用时通过 Spring 注入使用即可，<br>队列消费可以使用如下方式在项目启动的时候就进行阻塞监听队列，等待消费</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisBlockQueue redisBlockQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   redisBlockQueue.bRPopLPush(xx, (value) -&gt; &#123;</span><br><span class="line">     <span class="comment">//...</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="本文完整代码下载"><a href="#本文完整代码下载" class="headerlink" title="本文完整代码下载"></a>本文完整代码下载</h2><ul>
<li><a href="https://github.com/Mosiki/learning-modules/tree/master/learning-redis">github 地址 </a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-06-14T09:00:19.640Z" itemprop="dateUpdated">2020-06-14 17:00:19</time>
</span><br>


        
        本文链接：<a href="/redis-block-queue.html" target="_blank" rel="external">http://nullpointer.pw/redis-block-queue.html</a>
        
    </div>
    <footer>
        <a href="http://nullpointer.pw">
            <img src="/img/avatar.png" alt="WeJan">
            WeJan
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis阻塞队列实现/">Redis阻塞队列实现</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/异步队列处理/">异步队列处理</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://nullpointer.pw/redis-block-queue.html&title=《实战基于Redis实现阻塞队列》 — WeJan's Blog&pic=http://nullpointer.pw/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://nullpointer.pw/redis-block-queue.html&title=《实战基于Redis实现阻塞队列》 — WeJan's Blog&source=日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://nullpointer.pw/redis-block-queue.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《实战基于Redis实现阻塞队列》 — WeJan's Blog&url=http://nullpointer.pw/redis-block-queue.html&via=http://nullpointer.pw" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://nullpointer.pw/redis-block-queue.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/flyway-best-practice.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">【实战】Flyway迁移指南最佳实践</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/interface-authentication.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">接口鉴权签名实践</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
  -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'true' == 'true',
            appId: "4LBKQGjj91zO3FvvTypea844-MdYXbMMI",
            appKey: "g000TimpCo2dSkXYBxzm2Tdl",
            avatar: "monsterid",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        点开打赏说明本文值一块钱哈哈~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>WeJan &copy; 2016 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://nullpointer.pw/redis-block-queue.html&title=《实战基于Redis实现阻塞队列》 — WeJan's Blog&pic=http://nullpointer.pw/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://nullpointer.pw/redis-block-queue.html&title=《实战基于Redis实现阻塞队列》 — WeJan's Blog&source=日常需求开发过程中，不免会遇到需要通过代码进行异步处理的情况，比如批量发送邮件，批量发送短信，数据导入，为了减少用户的等待，不希望一直菊花转啊转，因此需要..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://nullpointer.pw/redis-block-queue.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《实战基于Redis实现阻塞队列》 — WeJan's Blog&url=http://nullpointer.pw/redis-block-queue.html&via=http://nullpointer.pw" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://nullpointer.pw/redis-block-queue.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3aS47DMAwE0dz/0s4JLFWTTgCLpdVgYMt6WRDi5/PB67pZ6yf5bvzd1pIhQ8ZrGddy8Wfudr474nr/+LsyZMgYwCCHIME3RXLq5swyZMiQUds6hLW+JUOGDBnLrdMnSciWIUOGjM7WaQFuXUpLk9sHcnEZMmS8kMGr7v//+yf9DRkyZLyKcYWLv5WGy6uxZMiQcTaDBzh+Zay1MElSvbloypAhYxiDBEee0K7TTkIlZ5AhQ8apjNqAV+eT6VukDCdDhowJjFrw5cV6nsSSRkLwG8uQIeMgRnCLLMHSgMt/FBkyZMxkkAtZ2nSsDXAERToZMmQMYPCLY+fQnQR4cxIZMmQMY6yvev0xsjTFRTwZMmSMYfAPd8pzvNgXJ7EyZMgYyagdhZf10902wxYyZMg4msEPTcC1Rib/1m0SK0OGjAGMoBAPAisPuDVeXL2TIUPGyxmcR0Jha8Ar/IE2/Q0ZMmQcwUivejztrAV0MmqGRi5kyJBxKKM2HkF24Pu33pIhQ8YABj8uvwLyNJX/P2hkypAh42hGren4i8YAr63JkCHjVMYVrvStGp7sg4YtZMiQcQSjVqZ/ajjjqZaDDBkyJjCeGnrgJbN0CAOdQYYMGQMYaXLLmwT8IvhYLi5DhgwZpQJZrYUZF91kyJAhAz/TSXcJadPClCFDxqGM2khErUxGQnP8pAwZMo5mpKkj/7t2ueSjYDJkyBjA+AJjgWqYnU17ygAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.0"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.0" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '出Bug了快来看！';
            clearTimeout(titleTime);
        } else {
            document.title = '对不起，我看错啦~';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
